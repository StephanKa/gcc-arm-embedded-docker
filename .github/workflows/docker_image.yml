name: Docker Image CI

on: [push]

jobs:
  linux:
    name: GCC ARM Toolchain ${{ matrix.compiler.name }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false  # 'false' means Don't stop matrix workflows even if some matrix entry fails.
      matrix:
        compiler: [{name: '6-2017-q2-update'},
                   {name: '7-2017-q4-major'},
                   {name: '7-2018-q2-update'},
                   {name: '8-2018-q4-major'},
                   {name: '8-2019-q3-update'},
                   {name: '9-2019-q4-major'},
                   {name: '9-2020-q2-update'},
                   {name: '10.3-2021.07'},
                   {name: '10.3-2021.10'},
                   {name: '11.3.rel1'},
                   {name: '12.2.rel1'}]
    steps:
    - uses: actions/checkout@v3
    - name: Build ARM GCC Toolchain ${{ matrix.compiler.name }} Docker
      run: docker build . --file ${{ matrix.compiler.name }}/Dockerfile -t gcc-arm-embedded-${{ matrix.compiler.name }}

    - name: Configure debug example with GCC Toolchain ${{ matrix.compiler.name }} Docker
      run: docker run -v ${PWD}/example:/builds gcc-arm-embedded-${{ matrix.compiler.name }} cmake --preset debug

    - name: Build debug example with GCC Toolchain ${{ matrix.compiler.name }} Docker
      run: docker run -v ${PWD}/example:/builds gcc-arm-embedded-${{ matrix.compiler.name }} cmake --build --preset debug

    - name: Configure release example with GCC Toolchain ${{ matrix.compiler.name }} Docker
      run: docker run -v ${PWD}/example:/builds gcc-arm-embedded-${{ matrix.compiler.name }} cmake --preset debug

    - name: Build release example with GCC Toolchain ${{ matrix.compiler.name }} Docker
      run: docker run -v ${PWD}/example:/builds gcc-arm-embedded-${{ matrix.compiler.name }} cmake --build --preset release
